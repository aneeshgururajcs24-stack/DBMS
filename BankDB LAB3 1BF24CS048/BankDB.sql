create database Bank;
use Bank;
CREATE TABLE Branch (
    BRANCHNAME VARCHAR(100) PRIMARY KEY,
    BRANCHCITY VARCHAR(100),
    ASSETS INT
);
CREATE TABLE BankAccount (
    ACCNO INT PRIMARY KEY,
    BRANCHNAME VARCHAR(100),
    BALANCE INT,
    FOREIGN KEY (BRANCHNAME) REFERENCES Branch(BRANCHNAME)
);
CREATE TABLE BankCustomer (
    CUSTOMERNAME VARCHAR(100),
    CUSTOMERSTREET VARCHAR(100),
    CUSTOMERCITY VARCHAR(100),
    PRIMARY KEY (CUSTOMERNAME)
);
CREATE TABLE Loan (
    LOANNUMBER INT PRIMARY KEY,
    BRANCHNAME VARCHAR(100),
    AMOUNT INT,
    FOREIGN KEY (BRANCHNAME) REFERENCES Branch(BRANCHNAME)
);
CREATE TABLE Depositer (
    CUSTOMERNAME VARCHAR(100),
    ACCNO INT,
    FOREIGN KEY (CUSTOMERNAME) REFERENCES BankCustomer(CUSTOMERNAME),
    FOREIGN KEY (ACCNO) REFERENCES BankAccount(ACCNO)
);
INSERT INTO Branch (BRANCHNAME, BRANCHCITY, ASSETS) VALUES 
('SBI_Charmajpet', 'Bangalore', 50000),
('SBI_ResidencyRoad', 'Bangalore', 10000),
('SBI_ShiivajiRoad', 'Bombay', 10000),
('SBI_ParliamentRoad', 'Delhi', 20000),
('SBI_Jantarmantar', 'Delhi', 20000);

INSERT INTO BankAccount (ACCNO, BRANCHNAME, BALANCE) VALUES 
(1, 'SBI_Charmajpet', 2000),
(2, 'SBI_ResidencyRoad', 5000),
(3, 'SBI_ShiivajiRoad', 6000),
(4, 'SBI_ParliamentRoad', 9000),
(5, 'SBI_Jantarmantar', 8000),
(6, 'SBI_ShiivajiRoad', 4000),
(7, 'SBI_Charmajpet', 8000),
(8, 'SBI_ResidencyRoad', 4000),
(9, 'SBI_ParliamentRoad', 3000),
(10, 'SBI_ResidencyRoad', 5000),
(11, 'SBI_Jantarmantar', 2000);

INSERT INTO BankCustomer (CUSTOMERNAME, CUSTOMERSTREET, CUSTOMERCITY) VALUES
('Avinash', 'Bull_Temple_Road', 'Bangalore'),
('Dinesh', 'Bannerghatta_Road', 'Bangalore'),
('Nikil', 'NationalCollege_Road', 'Bangalore'),
('Ravi', 'Akbar_Road', 'Delhi');

INSERT INTO Loan (LOANNUMBER, BRANCHNAME, AMOUNT) VALUES 
(1, 'SBI_Charmajpet', 5000),
(2, 'SBI_ResidencyRoad', 2000),
(3, 'SBI_ShiivajiRoad', 4000),
(4, 'SBI_ParliamentRoad', 2000),
(5, 'SBI_Jantarmantar', 5000);

INSERT INTO Depositer (CUSTOMERNAME, ACCNO) VALUES
('Avinash', 1),
('Dinesh', 2),
('Nikil', 4),
('Ravi', 5),
('Avinash', 8),
('Nikil', 9),
('Dinesh', 10),
('Nikil', 11);

SELECT BRANCHNAME, BRANCHCITY, ASSETS / 100000 AS 'ASSETS (in Lakhs)' FROM Branch;

SELECT D.CUSTOMERNAME, COUNT(D.ACCNO) AS AccountCount, B.BRANCHNAME
FROM Depositer D
JOIN BankAccount B ON D.ACCNO = B.ACCNO
GROUP BY D.CUSTOMERNAME, B.BRANCHNAME
HAVING COUNT(D.ACCNO) >= 2;

CREATE VIEW LoanSumPerBranch AS
SELECT BRANCHNAME, SUM(AMOUNT) AS 'Total Loans'
FROM Loan
GROUP BY BRANCHNAME;

SELECT * FROM LoanSumPerBranch;

ALTER TABLE Loan ADD CUSTOMERNAME VARCHAR(100);

SELECT DISTINCT L.CUSTOMERNAME
FROM Loan L
LEFT JOIN Depositer D ON L.CUSTOMERNAME = D.CUSTOMERNAME
WHERE D.ACCNO IS NULL;


SELECT DISTINCT D.CUSTOMERNAME
FROM Depositer D
JOIN BankAccount B ON D.ACCNO = B.ACCNO
JOIN Branch Br ON B.BRANCHNAME = Br.BRANCHNAME
WHERE Br.BRANCHCITY = 'Delhi'
GROUP BY D.CUSTOMERNAME
HAVING COUNT(DISTINCT B.BRANCHNAME) = (SELECT COUNT(*) FROM Branch WHERE BRANCHCITY = 'Delhi');

SELECT DISTINCT D.CUSTOMERNAME
FROM Depositer D
JOIN BankAccount B ON D.ACCNO = B.ACCNO
JOIN Loan L ON B.BRANCHNAME = L.BRANCHNAME AND D.CUSTOMERNAME = L.BRANCHNAME
WHERE B.BRANCHNAME = 'SBI_Charmajpet' AND L.BRANCHNAME = 'SBI_Charmajpet';

SELECT BRANCHNAME
FROM Branch
WHERE ASSETS > (SELECT MAX(ASSETS) FROM Branch WHERE BRANCHCITY = 'Bangalore');

DELETE FROM BankAccount
WHERE BRANCHNAME IN (SELECT BRANCHNAME FROM Branch WHERE BRANCHCITY = 'Bombay');

UPDATE BankAccount
SET BALANCE = BALANCE * 1.05;